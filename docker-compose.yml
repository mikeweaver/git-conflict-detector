version: '2'

services:
  post_deploy_checker_web:
    build:
      context: .
      args:
        RAILS_ENV: production
    image: invocaops/post_deploy_checker
    ports:
       - "3000:3000"
    environment:
      SECRET_KEY_BASE: CHANGEME
      RAILS_ENV: production
      SMTP_USER_NAME: CHANGEME
      SMTP_PASSWORD: CHANGEME
      SMTP_ADDRESS: CHANGEME
    command: ./script/docker_entry_points/unicorn.sh
    volumes:
      - ./tmp/cache/git:/tmp/git
      - ./db/production:/usr/src/pre_deploy_checker/db/production
      - ./log/docker:/usr/src/pre_deploy_checker/log
  post_deploy_checker_delayed_job:
    build:
      context: .
      args:
        RAILS_ENV: production
    image: invocaops/post_deploy_checker
    environment:
      SECRET_KEY_BASE: CHANGEME
      RAILS_ENV: production
      GITHUB_USER_NAME: CHANGEME
      GITHUB_PASSWORD: CHANGEME
      GITHUB_PRIVATE_KEY: CHANGEME
      GITHUB_PUBLIC_KEY: CHANGEME
      JIRA_PRIVATE_KEY: CHANGEME
    command: ./script/docker_entry_points/delayed_job.sh
    volumes_from:
       - post_deploy_checker_web


